<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bombardiro Battle</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="icon-192.png" type="image/png" />
  <style>
    body { font-family: sans-serif; background: #222; color: #fff; text-align: center; padding: 2rem; }
    .game-area { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
    .card { background: #444; border: 2px solid #fff; padding: 1rem; margin: 0.5rem; border-radius: 10px; width: 200px; cursor: pointer; }
    .hand { display: flex; justify-content: center; flex-wrap: wrap; gap: 1rem; }
    .log { margin-top: 1rem; height: 120px; overflow-y: auto; background: #111; padding: 1rem; border-radius: 8px; }
    .position-chooser { display: flex; gap: 1rem; justify-content: center; margin-top: 1rem; }
    .position-btn { padding: 0.5rem 1rem; background: #333; border: 1px solid #fff; cursor: pointer; border-radius: 5px; }
    .position-btn:hover { background: #555; }
  </style>
</head>
<body>
  <h1>üî• Bombardiro Battle üî•</h1>
  <div class="game-area">
    <div><strong>Ton adversaire a <span id="enemy-hp">20</span> PV</strong></div>
    <div><strong>Tu as <span id="player-hp">20</span> PV</strong></div>

    <div class="hand" id="player-hand"></div>
    <div class="position-chooser" id="position-chooser" style="display:none;"></div>

    <div class="log" id="game-log"></div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }

    const playerHP = document.getElementById('player-hp');
    const enemyHP = document.getElementById('enemy-hp');
    const handEl = document.getElementById('player-hand');
    const logEl = document.getElementById('game-log');
    const posChooser = document.getElementById('position-chooser');

    let player = { hp: 20 };
    let enemy = { hp: 20 };

    const cards = [
      {
        name: "üí• Croco-Choc",
        baseEffect: (pos) => {
          if (pos === 'avant') damageEnemy(3);
          else log("Croco-Choc en arri√®re ne peut pas attaquer, mais pr√©pare une riposte!");
        }
      },
      {
        name: "üßÄ Armure Fromag√©e",
        baseEffect: (pos) => {
          if (pos === 'arriere') log("Tu gagnes +1 armure (futur effet passif)");
          else log("Armure Fromag√©e pos√©e devant, inutilement...");
        }
      },
      {
        name: "üé≤ Tralala Myst√®re",
        baseEffect: (pos) => {
          const dmg = Math.ceil(Math.random() * 6);
          if (pos === 'avant') damageEnemy(dmg);
          else log("Tralala Myst√®re en arri√®re lib√®re une √©nergie myst√©rieuse (futur buff)");
        }
      },
      {
        name: "ü™É Banane Boomerang",
        baseEffect: (pos) => {
          if (pos === 'avant') {
            damageEnemy(2);
            drawCard("ü™É Banane Boomerang", (p) => damageEnemy(2));
          } else {
            log("Banane Boomerang lanc√©e de loin, effet affaibli (futur -1 dmg)");
          }
        }
      }
    ];

    function drawHand() {
      handEl.innerHTML = '';
      for (let i = 0; i < 3; i++) {
        const card = cards[Math.floor(Math.random() * cards.length)];
        drawCard(card.name, card.baseEffect);
      }
    }

    function drawCard(name, effectFn) {
      const card = document.createElement('div');
      card.className = 'card';
      card.textContent = name;
      card.onclick = () => {
        choosePosition(name, effectFn);
      };
      handEl.appendChild(card);
    }

    function choosePosition(name, effectFn) {
      posChooser.style.display = 'flex';
      handEl.style.display = 'none';
      posChooser.innerHTML = `
        <button class="position-btn" onclick="applyEffect('${name}', 'avant')">üõ°Ô∏è Avant</button>
        <button class="position-btn" onclick="applyEffect('${name}', 'arriere')">üß† Arri√®re</button>
      `;

      window.applyEffect = (cardName, position) => {
        const card = cards.find(c => c.name === cardName);
        if (card) card.baseEffect(position);
        posChooser.innerHTML = '';
        posChooser.style.display = 'none';
        handEl.style.display = 'flex';
        endTurn();
      }
    }

    function damageEnemy(amount) {
      enemy.hp -= amount;
      enemyHP.textContent = enemy.hp;
      log(`üí• Tu infliges ${amount} d√©g√¢ts √† l'adversaire !`);
      checkWin();
    }

    function damagePlayer(amount) {
      player.hp -= amount;
      playerHP.textContent = player.hp;
      log(`ü§ï L'ennemi t'inflige ${amount} d√©g√¢ts !`);
      checkWin();
    }

    function enemyTurn() {
      const dmg = Math.ceil(Math.random() * 4);
      damagePlayer(dmg);
    }

    function endTurn() {
      handEl.innerHTML = '';
      setTimeout(() => {
        enemyTurn();
        setTimeout(() => drawHand(), 500);
      }, 500);
    }

    function checkWin() {
      if (enemy.hp <= 0) {
        alert("üéâ Victoire ! L‚Äôadversaire est KO !");
        location.reload();
      } else if (player.hp <= 0) {
        alert("üíÄ D√©faite ! Tu es KO...");
        location.reload();
      }
    }

    function log(msg) {
      logEl.innerHTML += `<div>${msg}</div>`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    drawHand();
  </script>
</body>
</html>